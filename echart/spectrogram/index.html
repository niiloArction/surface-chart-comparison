<!DOCTYPE html>
<html lang="en">
<head>
</head>
<body>

    <!-- Prepare a DOM with a defined width and height for ECharts -->
    <div id="main" style="width: 600px;height:400px;"></div>

    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts-gl/dist/echarts-gl.min.js"></script>

    <script src="../xydata.iife.js"></script>

    <script type="text/javascript">


        const CONFIG = {    
            // NOTE: Columns = X Axis
            columns: 50,
            // NOTE: Rows = Z Axis
            rows: 60,
        }


        const {
            createSpectrumDataGenerator
        } = xydata
        const { rows, columns } = CONFIG

      // Initialize the echarts instance based on the prepared dom
        var chartDom = document.getElementById('main');
        var myChart = echarts.init(chartDom);

        // options
        var option;

        // array of data
        var z_data=[ ]


        // options for chart
        option = {
            tooltip: {},
            backgroundColor: '#fff',
            visualMap: {
                show: false,
                dimension: 2,
                min: -1,
                max: 1,
            },
            xAxis3D: {
                type: 'value',
            },
            yAxis3D: {
                type: 'value',
            },
            zAxis3D: {
                type: 'value',
            },
            grid3D: {
                viewControl: {
                    projection: 'orthographic'
                },
                // hide grid and axes
                show: true,

            },
            series: [
                {
                    type: 'surface',
                    data: [...z_data]
                }
            ]
        };
         
        // build chart
        myChart.setOption(option);


        createSpectrumDataGenerator()
            .setSampleSize( columns )
            .setNumberOfSamples( rows )
            .generate()
            .toPromise()
            .then(data => {

                // add data
                // data.forEach((element, i) => {
                //     element.forEach((el, k)=>{
                //         z_data.push([k,i,el])
                //     })
                // });

                // data stream
                let iSample = 0
                let minY = 0
                let r = 1
                const addData = () => {
                    iSample = (iSample + 1) % rows
                    const sample = data[iSample]

                    sample.forEach((el, i)=>{
                       z_data.push(
                            [i, r, el]
                        )
                        // keep array lenght = 60
                        if(r>60) z_data.shift()
                    })

                    // keep Y axis  interval = 60
                    if(r>60) minY++
                

                    // reset options
                    myChart.setOption({
                        // set Y axis ragne
                        yAxis3D: {
                            max: r,
                            min: minY
                        },
                        // change series
                        series: [
                            {
                                data: [...z_data]
                            }
                        ]
                    });
                    
                    // add +1 row
                    r++

                    setTimeout(addData, 100)
                }
                addData()


            })


    </script>
  </body>
</html>
